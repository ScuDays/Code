
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备记录管理</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap.min.css">
</head>
<body>
<div class="container">
    <h2>设备记录管理</h2>
    <button type="button" id="get_data_button" name="get_data_button" onclick="javascript:getData();">查询</button>
    <button type="button" id="add_data_button" name="add_data_button" onclick="javascript:goToAddPage();">添加</button>

    <!-- 添加复选框 -->
    <div id="checkboxes">
        <label><input type="checkbox" class="column-toggle" data-column="0" checked> 事件id</label>
        <label><input type="checkbox" class="column-toggle" data-column="1" checked> 事件</label>
        <label><input type="checkbox" class="column-toggle" data-column="2" checked> 创建人</label>
        <label><input type="checkbox" class="column-toggle" data-column="3" checked> 创建时间</label>
        <label><input type="checkbox" class="column-toggle" data-column="4" checked> 操作</label>
    </div>

    <div class="row" id="datatable_tab">
        <div class="col-md-12">
            <table class="table table-striped table-bordered table-hover datatable" id="record_list">
                <thead>
                <tr>
                    <th>事件id</th>
                    <th>事件</th>
                    <th>创建人</th>
                    <th>创建时间</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="message" name="message"></div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap.min.js"></script>

<script>
    function getData(){
        getDeviceRecord();
    }

    function getDeviceRecord() {
        axios.post("/device/get_record", {})
            .then(function(res) {
                console.log(res.data.aaData);
                getDeviceRecordDataTable(res.data.aaData);
            })
            .catch(function(err) {
                console.log(err);
            });
    }

    var getDeviceRecordDataTable = function (data) {
        resultList = [];
        if ($.fn.DataTable.isDataTable('.datatable')) {
            $('.datatable').DataTable().destroy();
        }
        $('.datatable tbody').empty();

        var table = $('.datatable').DataTable({
            "paging": true,
            "searching": false,
            "oLanguage": {
                "aria": {
                    "sortAscending": ": activate to sort column ascending",
                    "sortDescending": ": activate to sort column descending"
                },
                "sProcessing": "处理中...",
                "sLengthMenu": "_MENU_ 记录/页",
                "sZeroRecords": "没有匹配的记录",
                "sInfo": "显示第 _START_ 至 _END_ 项记录，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项记录，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项记录过滤)",
                "sInfoPostFix": "",
                "sSearch": "过滤:",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                }
            },
            "columns": [
                { "data": "device_id", "orderable": false },
                { "data": "device_name", "orderable": false },
                { "data": "device_type", "orderable": false },
                { "data": "create_time", "orderable": false },
                {
                    "orderable": false,
                    "render": function (data, type, full) {
                        resultList.push(full);
                        return '<div><a href="javascript:modifyRecord(' + full.id + ')">【修改记录】</a></div>';
                    }
                }
            ],
            "aLengthMenu": [[5, 10, 15, 20, 25, 40, 50, -1], [5, 10, 15, 20, 25, 40, 50, "所有记录"]],
            "data": data // Ensure data is passed to DataTable
        });

        // 添加复选框事件监听器
        $('.column-toggle').change(function() {
            var column = table.column($(this).attr('data-column'));
            column.visible(!column.visible());
        });
    };

    function modifyRecord(id) {
        window.location.href = 'modify_device.html?id=' + id;
    }

    function goToAddPage() {
        window.location.href = 'device_add.html';
    }

    window.onload = function() {
        getData();
    }
</script>
</body>
</html>
